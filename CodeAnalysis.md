# Code analysis for Software Security Engineering
**CSCI - 8420:  Assurance Army**

Aaron Kirby, Krishna Teja Ayinala, Sindhura Bonthu   </br>

Project: Nuxeo

# Code review Strategy
Nuxeo is a very large open-source project with copious amounts of code. Due to it's size, we planned our code review strategy accordingly. It was impractical to sift through the output of a tool for the entire project codeset, and even more so to manually review it.

We adopted a combination of Scenario-based and Checklist-based strategies. We utilized our previously created Assurance cases and Misuse cases to identify data flows and potentially vulnerable areas of the Nuxeo Platform. We scoured the Nuxeo Platform code and focused on the code sections that dealt with these data flows. In this way, we greatly reduced the amount of code we needed to review, both manually and with automated tools. These are the data flows we focused on:

1) Form and set group permissions. (Authentication)
2) Edit, save, or modify data to the cloud. (Encryption) 
3) Store and retrieve data from the database, drive. (Third-party)
4) Export data into different formats, specific permissions on RWX. (Read, write, download)
5) Maintaining proper VCS of modifications on the shared doc. (Audit)

We then narrowed our focus even further by referencing our Threat models of the previosly mentioned scenarios The Threat models helped us create a checklist of issues to specifically look for in the code, and eliminated a lot of issues generated by the automated tool. We looked for STRIDE issues that could potentially be present.

Once our code review strategy was decided upon, we initially tried tools like SWAMP, Findbugs, and Sonarcloud to analyse our identified code sections. Due to various reasons, we did not succeed in producing an assessment report for any of the tools.

- SWAMP & Findbugs: because of the external dependencies [build requirements](https://github.com/nuxeo/nuxeo#building), the project could not be built, which prevented it from being analyzed.
- Sonarcloud: there were some assessments of Nuxeo projects present, but the main project that we are reviewing was not.

We were able to analyse our identified code sections on PMD,  based on the default JAVA rulesets in the tool. After sifting through the results and summarizing the relevant findings, we manually reviewed the code sections for any issues from our checklist.

# Findings from manual code review

1) Form and set group permissions. (Authentication) </br>
There was a lot of code to manually review, but We could not find any glaring security weaknesses. Nuxeo Platform uses Findbugs as part of it's automated code review, so it's not surprising that obvious weaknesses are absent.

2) Edit, save, or modify data to the cloud. (Encryption)


3) Store and retrieve data from the database, drive. (Third-party) </br>
The checklist considered while doing manual review for third party storage is the list of CWE's
[[CWE-5](https://cwe.mitre.org/data/definitions/5.html), [CWE-311](https://cwe.mitre.org/data/definitions/311.html), [CWE-300](https://cwe.mitre.org/data/definitions/300.html), [CWE-346](https://cwe.mitre.org/data/definitions/346.html)]. The first thing reviewd is whether the data to be transfered is properly encrypted or not. The [CWE-5](https://cwe.mitre.org/data/definitions/5.html), [CWE-311](https://cwe.mitre.org/data/definitions/311.html) are checked in the second dataflow. While reviewing for [CWE-300](https://cwe.mitre.org/data/definitions/300.html), LDAP code is reviewed which is enforcing SSL. Many of the catch blocks are not handled. While reviewing for [CWE-346](https://cwe.mitre.org/data/definitions/346.html), the tokens are validated based on the session time in OAuth2TokenStore.


4) Export data into different formats, specific permissions on RWX. (Read, write, download) </br>
The autmated PMD tool found a potential [weakness](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-7.xml), but manually reviewing the code revealed it to be a false positive. The method does create an new instance with every method call, but the user is then mapped to 1 of 3 scenarios or an excption is thrown. The weakness PMD was addressing is handled in the thrown exception.


5) Maintaining proper VCS of modifications on the shared doc. (Audit)


# Findings from automated code scanning
PMD is the only tool we were able to get working. The analysis is done in the command line and the output can be either text or xml. The following summaries are grouped by the data flows we identified.

[Full Report](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/Codereview%20reference%20links/Full-Report-nuxeo.xml): output of the entire Nuxeo Platform code base. Only specified areas were reviewed for security threats.

1) Form and set group permissions. (Authentication) [1](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-1.xml) [2](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-2.xml) [3](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-3.xml) [4](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-4.xml) [5](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-5.xml) [6](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-6.xml) [7](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-7.xml) [8](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-8.xml) [9](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-9.xml) [10](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-10.xml) [11](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-11.xml) [12](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-12.xml) </br>
Code for authentication is found in many different places, which makes sense since it is a very basic, yet important security measure. The revied code focuses on user/password authentication (including mapping a uder ID from a third party to a Nuxeo userID) and OAuth2 services. PMD found many violations; however, the vast majority are stylistic or best practices. One common violation is "Logger calls should be surrounded by log level guards", but this is mostly an efficiency concern. The only violation of note is "[getInstance method always creates a new object and hence does not comply to Singleton Design Pattern behaviour. Please review](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF1-7.xml)." This does not directly translate to a CWE, but [CWE 543](https://cwe.mitre.org/data/definitions/543.html) potentially becomes an issue assuming that multithreading is used.


2) Edit, save, or modify data to the cloud. (Encryption) [(1)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/commit/0b0c5c30cfd994c77183b6d34075c9c7717fbebe) <br>
One of the most common potential vulnerability found by PMD is ‘Logger calls should be surrounded by log level guards.’ Other medium level vulnerability found in encryption code is empty Catch Block. In this case, the error condition will be swallowed and the execution continues. 


3) Store and retrieve data from the database, drive. (Third-party)  [(1)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/TP-1.xml) [(2)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/TP-2.xml) [(3)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/TP-3.xml) [(4)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/TP-4.xml) <br>
Third party data transfers involves with data encryption, authentications and time enabled sessions. Along with results from above two data flows the reults of PMD tool for code of time enabled seesions, Secure transport and token generation for block chain technology are mostly about style of code with most common violation "Logger calls should be surrounded by log level guards".


4) Export data into different formats, specific permissions on RWX. (Read, write, download) [1](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF4-1.xml) [2](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF4-2.xml) [3](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF4-3.xml) [4](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF4-4.xml) [5](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/DF4-5.xml) </br>
This data flow mainly exists in the code dealing with versioning, storage, or the repository. The code deals with user permissions but in the context of document read, write, and download. All violations were stylistic or best practices; no security threats were identified.


5) Maintaining proper VCS of modifications on the shared doc. (Audit) [(1)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/Versioning.xml)  [(2)](https://github.com/kteja-ayinala/SW-Assurance-Term-Project/blob/master/code%20review%20doc/V-1.xml) <br>
Versioning code  deals with maintaining all the changes with proper versions making the log immutable. From the reults of PMD tool for versioning code the common violation is "Avoid using implementation types like 'ArrayList'; use the interface instead" along with the "Logger calls should be surrounded by log level guards".


**Github Project Board:** https://github.com/kteja-ayinala/SW-Assurance-Term-Project/projects/5
